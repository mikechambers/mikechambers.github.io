
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
	<script type="text/javascript" src="//use.typekit.net/gib0bhv.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>	
	
  <meta charset="utf-8">
  <title>JavaScript QuadTree Implementation - Mike Chambers</title>
  <meta name="author" content="Mike Chambers">

  
  <meta name="description" content="Last week I was playing around with a little EaselJS experiment which required me to do collision detection against all items on the screen. This &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mikechambers.github.io//2011/03/21/javascript-quadtree-implementation">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Mike Chambers" type="application/atom+xml">

  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-553659-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>



<body >

<!--
<body   >
-->
  <header role="banner"><hgroup>
  <h1><a href="/">Mike Chambers</a></h1>
  
    <h2>code is beautiful</h2>
  
</hgroup>

</header>
  <nav role="navigation"><!--
<ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul> -->
<ul class="subscription">
	<li><a href="/blog/archives">about</a></li>
	<li><a href="/blog/archives">code</a></li>
	<li><a href="/blog/archives">photography</a></li>
	<li><a href="/blog/archives">twitter</a></li>
	<li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">rss</a></li>
</ul>


<!--
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mikechambers.github.io/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
-->
<ul class="main-navigation">
	<li><a href="/">home</a></li>
	<li><a href="/blog/archives">archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">JavaScript QuadTree Implementation</h1>
    

    
      <p class="meta">
        <!--








  


<time datetime="2011-03-21T13:47:01-07:00" pubdate data-updated="true">Monday, March 21, 2011</time>-->
        
      </p>
    
  </header>


<div class="entry-content"><p>Last week I was playing around with a little <a href="http://www.easeljs.com">EaselJS</a> experiment which required me to do collision detection against all items on the screen. This worked fine with a small number of items, but of course, the more items I added, the slower everything became.</p>

<p>I knew that I needed to optimize the code, and pare down the number of collision checks. I have done this before with a grid (even held a <a href="http://www.mikechambers.com/blog/tag/as3dtc1/">contest</a> for it) and was going to port that AS3 code to JavaScript. However, <a href="http://unitzeroone.com/blog/">Ralph Hauwert</a> suggested I look at implemented a QuadTree, which should be more efficient.</p>

<!--more-->


<p>A <a href="http://en.wikipedia.org/wiki/Quadtree">QuadTree</a> is a data structure in which the coordinate space is broken up into regions / nodes that contain items. If too many items are added into a node, then that node is divided into 4 sub-nodes. This can provide very fast lookup of items based on the coordinates and coordinates and dimensions.</p>

<p>There are a couple of implementations in both JavaScript and ActionScript (Michael Baczynski has a nice <a href="http://lab.polygonal.de/2007/09/09/quadtree-demonstration/">AS3 implementation</a>), but I decided that I wanted to learn a bit more and implement one from scratch.</p>

<p>The result if a QuadTree implemented in JavaScript that works with both 2D coordinates (x,y) and well as regions / items with dimensions.</p>

<p>I&rsquo;ve released all of the code under an MIT License, and you can <a href="https://github.com/mikechambers/ExamplesByMesh/tree/master/JavaScript/QuadTree">download it from my GitHub repository</a>.</p>

<p>Here is an example of the tree in action:</p>

<iframe src="/html5/javascript/QuadTree/examples/collision.html" width="520" height="600"></iframe>


<p>This example shows how to use the QuadTree to pare down the number of items that need to be tested for collision detection.</p>

<p>I have created a couple of other simple examples:</p>

<ul>
<li><a href="/html5/javascript/QuadTree/examples/collision.html">Collision Detection (shown above)</a></li>
<li><a href="/html5/javascript/QuadTree/examples/insert.html">Inserting points</a></li>
<li><a href="/html5/javascript/QuadTree/examples/insert_bounds.html">Inserting items with bounds</a></li>
<li><a href="/html5/javascript/QuadTree/examples/retrieve.html">Retrieving points</a></li>
<li><a href="/html5/javascript/QuadTree/examples/retrieve_bounds.html">Retrieving items with bounds</a></li>
</ul>


<p>The basic code is pretty simple. Here is an example showing using the QuadTree to store and retrieve points:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">pointQuad</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">bounds</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">x</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">y</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">width</span><span class="o">:</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">height</span><span class="o">:</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">quad</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QuadTree</span><span class="p">(</span><span class="nx">bounds</span><span class="p">,</span> <span class="nx">pointQuad</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//insert a random point</span>
</span><span class='line'><span class="nx">quad</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="nx">x</span><span class="o">:</span><span class="mi">12</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span><span class="mi">25</span><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="nx">quad</span><span class="p">.</span><span class="nx">retrieve</span><span class="p">({</span><span class="nx">x</span><span class="o">:</span><span class="mi">11</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span><span class="mi">20</span><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>And here is a simple example showing using the QuadTree to store and retrieve items with dimensions / bounds:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">bounds</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">x</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">y</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">width</span><span class="o">:</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">height</span><span class="o">:</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">quad</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QuadTree</span><span class="p">(</span><span class="nx">bounds</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//insert a random point</span>
</span><span class='line'><span class="nx">quad</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">x</span><span class="o">:</span><span class="mi">12</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">y</span><span class="o">:</span><span class="mi">25</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">height</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">width</span><span class="o">:</span><span class="mi">25</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>      
</span><span class='line'><span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="nx">quad</span><span class="p">.</span><span class="nx">retrieve</span><span class="p">({</span><span class="nx">x</span><span class="o">:</span><span class="mi">11</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span><span class="mi">20</span><span class="p">,</span> <span class="nx">height</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span><span class="mi">20</span><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, you can download all of the code from my <a href="https://github.com/mikechambers/ExamplesByMesh/tree/master/JavaScript/QuadTree">GitHub Repository</a>. It seems fairly solid at this point, but if you find any issues, or have any suggestions either fork the project, and submit the changes to me, or post them in the comments.</p>

<p>There is still a lot of room for optimization and improvement in the implementation, such as pre-allocating the nodes, but Ill leave that for another day.</p>

<p>Btw, big thanks to <a href="http://unitzeroone.com/blog/">Ralph Hauwert</a> for pointing me in the right direction for my project.</p>

<p>Post any questions or suggestions in the comments.</p>
</div>


  <footer>
    <p class="meta">
      <!--
  

<span class="byline author vcard">Posted by <span class="fn">mikechambers</span></span>

      








  


<time datetime="2011-03-21T13:47:01-07:00" pubdate data-updated="true">Monday, March 21, 2011</time>
-->

  

<span class="byline author vcard">Posted by <span class="fn">mikechambers</span></span>
 on 








  


<time datetime="2011-03-21T13:47:01-07:00" pubdate data-updated="true">Monday, March 21, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/general/'>General</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://mikechambers.github.io//2011/03/21/javascript-quadtree-implementation/" data-via="mesh" data-counturl="http://mikechambers.github.io//2011/03/21/javascript-quadtree-implementation/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2011/03/12/how-to-enable-english-translation-for-japanese-nhk-channel-on-comcast/" title="Previous Post: How to enable English translation for Japanese NHK Channel on Comcast">&laquo; How to enable English translation for Japanese NHK Channel on Comcast</a>
      
      
        <a class="basic-alignment right" href="/2011/03/24/javascript-voronoi-port/" title="Next Post: JavaScript Voronoi port">JavaScript Voronoi port &raquo;</a>
      
    </p>
  </footer>
</article>

</div>
<!--

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/14/test-post/">Test Post</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/08/simple-http-server-for-local-testing/">Simple HTTP Server for Local Testing</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/02/north-american-flash-community-tour/">North American Flash Community Tour</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/22/flash-roadmap-whitepaper-published/">Flash Roadmap Whitepaper Published</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/13/in-europe-to-discuss-flash-roadmap/">In Europe to Discuss Flash Roadmap</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/mikechambers">@mikechambers</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mikechambers',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:mikechambers">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "mikechambers"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/mikechambers@gmail.com?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

-->

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Mike Chambers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mikechambers';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
