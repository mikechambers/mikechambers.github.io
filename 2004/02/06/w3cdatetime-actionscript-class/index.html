
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
	<script type="text/javascript" src="//use.typekit.net/gib0bhv.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>	
	
  <meta charset="utf-8">
  <title>W3CDateTime ActionScript Class - Mike Chambers</title>
  <meta name="author" content="Mike Chambers">

  
  <meta name="description" content="As part of the ActionScript 2 [Atom class][1] that I am putting together, I have created an ActionScript class that represents a [W3CDateTime][2] &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mikechambers.github.io//2004/02/06/w3cdatetime-actionscript-class">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Mike Chambers" type="application/atom+xml">

  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-553659-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>



<body >

<!--
<body   >
-->
  <header role="banner"><hgroup>
  <h1><a href="/">Mike Chambers</a></h1>
  
    <h2>code is beautiful</h2>
  
</hgroup>

</header>
  <nav role="navigation"><!--
<ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul> -->
<ul class="subscription">
	<li><a href="/blog/archives">about</a></li>
	<li><a href="/blog/archives">code</a></li>
	<li><a href="/blog/archives">photography</a></li>
	<li><a href="/blog/archives">twitter</a></li>
	<li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">rss</a></li>
</ul>


<!--
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mikechambers.github.io/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
-->
<ul class="main-navigation">
	<li><a href="/">home</a></li>
	<li><a href="/blog/archives">archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">W3CDateTime ActionScript Class</h1>
    

    
      <p class="meta">
        <!--








  


<time datetime="2004-02-06T12:47:01-08:00" pubdate data-updated="true">Friday, February 06, 2004</time>-->
        
      </p>
    
  </header>


<div class="entry-content"><p>As part of the ActionScript 2 [Atom class][1] that I am putting together, I have created an ActionScript class that represents a [W3CDateTime][2] string. This is the format that [Atom][3] uses to represent dates.</p>

<p>A beta of the class and simple usage example is included below. If you have any questions or suggestions (especially parsing optimizations), or find any bugs, please post them in the comments.</p>

<!--more-->


<p>Here is a simple example of the class in use:</p>

<p>`</p>

<pre>import com.macromedia.date.W3CDateTime;

var timeString:String = "2004-02-05T16:36:35-05:00";

trace(timeString);

var d:W3CDateTime = new W3CDateTime(timeString);
trace(d);
trace(new Date(d.getTime()));</pre>


<p><p>`</p>

<p>Here is the entire class:</p>

<p>`
<pre>/*</p>

<pre><code>W3CDateTime.as

Mike Chambers
mesh@macromedia.com

Represents a date in the W3CDateTime format as described in
</code></pre>

<p><a href="http://www.w3.org/TR/NOTE-datetime">http://www.w3.org/TR/NOTE-datetime</a></p>

<pre><code>version .60

Known Issues:
    -The class does not support decimal seconds. Any decimal seconds
        specificed in a W3CDateTime string will be lost / removed.

TODO:
    -Look at optimize parsing code
    -Extensive Testing
    -Look into supporting decimal seconds

Thanks to:
    Tatsuo Kato, Peter Hall and Gary Grossman for help with determining the
    UTC offsets.
</code></pre>

<p>*/</p>

<p>/<em>Extends the Date object</em>/
class com.macromedia.date.W3CDateTime extends Date
{</p>

<pre><code>/*
    Constructor. Optionally takes a WC3DateTime string that the instance
    will represent.

    Otherwise, it represents the time that the instance was created.
*/
public function W3CDateTime(dateString:String)
{
    if(dateString != undefined)
    {
        setDateTimeString(dateString);
    }
}

/*
    Takes a W3CDateTime formatted string and sets the instance to represent
    the date and time represented in that string
*/
public function setDateTimeString(dateString:String):Void
{
        //this.dateString = dateString;
         setTime(W3CDateTime.parseString(dateString).getTime());        
}

/*
    Returns a W3CDateTime formatted string that represents the date represented
    by the current instance.

    Takes 4 optional arguments which specifies the format of the string:

    incMonth : Whether the month should be included.

    incDay : Whether the day of the month should be included. 

    incHours : Whether the hours and minutes should be included.

    incSeconds : Whether the seconds should be included.

    Note, that all output will be a valid W3CDataTime item.
*/
public function getDateTimeString(incMonth:Boolean,
                                    incDay:Boolean,
                                    incHours:Boolean,
                                    incSeconds:Boolean):String
{
    return W3CDateTime.parseDate(this, incMonth, incDay, incHours, incSeconds);
}    

/*
    Returns the full W3CDateTime string represented by the instance.
*/
public function toString(Void):String
{
    return getDateTimeString(true, true, true, true);       
}   

/*
    Returns the Year the W3CDateTime represents in the following format:
    YYYY
*/
public function getW3CYear(Void):String
{
    return getFullYear().toString();
}

/*
    Returns the Month the W3CDateTime represents in the following format:
    MM

    where 1 = January
*/
public function getW3CMonth(Void):String
{
    return (getMonth() + 1).toString();
}

/*
    Returns the day of the month the W3CDateTime represents in the
    following format:
    dd
*/  
public function getW3CDate(Void):String
{
    return getDate().toString();
}

/*
    Returns the hour the W3CDateTime represents in the
    following format:
    hh      
*/
public function getW3CHours(Void):String
{
    //adjust for utc?
    return getHours().toString();
}   

/*
    Returns the minutes the W3CDateTime represents in the
    following format:
    mm      
*/  
public function getW3CMinutes(Void):String
{
    return getMinutes().toString();
}   

/*
    Returns the seconds the W3CDateTime represents in the
    following format:
    ss      
*/  
public function getW3CSeconds(Void):String
{
    return getMinutes().toString();
}   

/*
    Returns the UTC offset the W3CDateTime represents in the
    following format:
    +/-hh:mm

    Note, if there is no offset, it will return
    Z       
*/  
public function getW3CUTCOffset(Void):String
{
    return W3CDateTime.formatTimezoneOffset(this);
}   

/*
    Static functions that takes a String representation of a number and adds
    a leading 0 if it is a single digit.
*/
public static function padDigit(digit:String):String
{
    if(digit.length &lt; 2)
    {
        return "0" + digit;
    }

    return digit;
}

/*
    Static function that takes an ActionScript Date object and returns
    a well formed W3CDateTime String that represents the specified date.

    Takes 4 additional optional arguments which specifies the format of
    the string:

    incMonth : Whether the month should be included.

    incDay : Whether the day of the month should be included. 

    incHours : Whether the hours and minutes should be included.

    incSeconds : Whether the seconds should be included.

    Note, that all output will be a valid W3CDataTime item.     
*/
public static function parseDate(inDate:Date, 
                                    incMonth:Boolean,
                                    incDay:Boolean,
                                    incHours:Boolean,
                                    incSeconds:Boolean):String
{
    if(inDate == undefined)
    {
        return undefined;
    }

    if(incMonth == undefined)
    {
        incMonth = false;
    }

    if(incDay == undefined)
    {
        incDay = false;
    }

    if(incHours == undefined)
    {
        incHours = false;
    }       

    if(incSeconds == undefined)
    {
        incSeconds = false;
    }       

    var now:Date = new Date();

    var w3cString:String = now.getFullYear().toString();

    if(!incMonth)
    {
        return w3cString;
    }

    w3cString += "-" + W3CDateTime.padDigit((now.getMonth() + 1).toString());

    if(!incDay)
    {
        return w3cString;           
    }

    w3cString += "-" + W3CDateTime.padDigit(now.getDate().toString());

    if(!incHours)
    {
        return w3cString;           
    }

    w3cString += "T" + W3CDateTime.padDigit(now.getHours().toString()) +
                        ":" + W3CDateTime.padDigit(now.getMinutes().toString());        

    if(!incSeconds)
    {
        //need to format the timeset appropriately
        return w3cString + W3CDateTime.formatTimezoneOffset(now);           
    }

    return w3cString + ":" + W3CDateTime.padDigit(now.getSeconds().toString()) +
                            W3CDateTime.formatTimezoneOffset(now);
}

/*
    Static methods that takes an ActionScript date instance, and returns
    the UTC offset in the format used in a W3CDateTime string.

    The format is:

    +/-hh:mm

    If the offset is 0, then method will return
    Z
*/
public static function formatTimezoneOffset(d:Date):String
{
    var timezoneOffset:Number = d.getTimezoneOffset();

    if(timezoneOffset == 0)
    {
        return "Z";
    }

    var operator:String = (timezoneOffset &gt; -1)? "+" : "-";

    if(timezoneOffset &lt; 0)
    {
        timezoneOffset *= -1;
    }

    //what if offset if 0 or less
    var hours:String = (timezoneOffset / 60).toString();
    var seconds:String = (timezoneOffset - (hours * 60)).toString();

    return operator + W3CDateTime.padDigit(hours) +
                        ":" + W3CDateTime.padDigit(seconds);
}

/*
    Static method that takes a W3CDateTime string and returns an
    ActionScript Date object that represents the string passed in.
*/
public static function parseString(dateString:String):Date
{
    if(dateString == undefined || dateString.length &lt; 1)
    {
        return undefined;
    }

    var YYYY:String = dateString.substr(0, 4);
    var MM:String = dateString.substr(5, 2);
    var DD:String = dateString.substr(8, 2);
    var hh:String = dateString.substr(11, 2);
    var mm:String = dateString.substr(14, 2);
    var ss:String = dateString.substr(17, 2);
    var s:String = "";

    var offsetOperator:String;
    var offsetHours:String;
    var offsetMinutes:String;

    var offset:Number = 0;      
    var operator:Number;
    var indexBump:Number = 0;

    if(dateString.substr(19, 1) == ".")
    {
        //they have a decimal second
        s = dateString.substr(20, 2);

        indexBump = 3;          
    }
    else
    {
        indexBump = 0;
        //they dont have a decimal second
    }

    offsetOperator = dateString.substr(19 + indexBump,1);
    offsetHours = dateString.substr(20 + indexBump,2);
    offsetMinutes = dateString.substr(23 + indexBump,2);

    //this could be wrong if there is no operator
    operator = ((offsetOperator == "-") || (offsetOperator == undefined))? 1 : -1; 

    //this could be wrong if offsethours or offsetminutes is undefined
    offset = operator * (Number(offsetHours) * 60) + Number(offsetMinutes);

    if(isNaN(offset))
    {
        offset = 0;
    }

    var minutes:Number;
    if(mm != "")
    {
        minutes = Number(mm) + offset;
    }

    var month:Number;
    if(MM != "")
    {
        month = Number(MM) - 1;
    }

    var year:Number;
    if(YYYY != "")
    {
        year = Number(YYYY);
    }

    var day:Number;
    if(DD != "")
    {           
        day = Number(DD);
    }

    var hours:Number;
    if(hh != "")
    {
        hours = Number(hh);
    }       

    var seconds:Number;
    if(ss != "")
    {
        seconds = Number(ss);
    }   

    var utcTimeMS = Date.UTC(
            year,
            month, 
            day,
            hours, 
            minutes,
            seconds);

    return new Date(utcTimeMS);;
}
</code></pre>

<p>}</pre>
<p>`</p>

<p> [1]: <a href="http://www.markme.com/mesh/archives/004355.cfm">http://www.markme.com/mesh/archives/004355.cfm</a>
 [2]: <a href="http://www.w3.org/TR/NOTE-datetime">http://www.w3.org/TR/NOTE-datetime</a>
 [3]: <a href="http://www.atomenabled.org">http://www.atomenabled.org</a></p>
</div>


  <footer>
    <p class="meta">
      <!--
  

<span class="byline author vcard">Posted by <span class="fn">mikechambers</span></span>

      








  


<time datetime="2004-02-06T12:47:01-08:00" pubdate data-updated="true">Friday, February 06, 2004</time>
-->

  

<span class="byline author vcard">Posted by <span class="fn">mikechambers</span></span>
 on 








  


<time datetime="2004-02-06T12:47:01-08:00" pubdate data-updated="true">Friday, February 06, 2004</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/actionscript/'>ActionScript</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://mikechambers.github.io//2004/02/06/w3cdatetime-actionscript-class/" data-via="mesh" data-counturl="http://mikechambers.github.io//2004/02/06/w3cdatetime-actionscript-class/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2004/02/06/mxdu-here-i-come/" title="Previous Post: MXDU Here I Come">&laquo; MXDU Here I Come</a>
      
      
        <a class="basic-alignment right" href="/2004/02/06/video-update-12-for-flash-mx-professional-2004/" title="Next Post: Video Update 1.2 for Flash MX Professional 2004">Video Update 1.2 for Flash MX Professional 2004 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>
<!--

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/14/test-post/">Test Post</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/08/simple-http-server-for-local-testing/">Simple HTTP Server for Local Testing</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/02/north-american-flash-community-tour/">North American Flash Community Tour</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/22/flash-roadmap-whitepaper-published/">Flash Roadmap Whitepaper Published</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/13/in-europe-to-discuss-flash-roadmap/">In Europe to Discuss Flash Roadmap</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/mikechambers">@mikechambers</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mikechambers',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:mikechambers">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "mikechambers"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/mikechambers@gmail.com?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

-->

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Mike Chambers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mikechambers';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
