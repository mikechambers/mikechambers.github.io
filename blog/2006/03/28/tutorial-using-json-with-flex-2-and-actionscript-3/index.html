<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Tutorial : Using JSON with Flex 2 and ActionScript 3</title>
        <meta name="viewport" content="width=device-width">

		<script type="text/javascript" src="//use.typekit.net/gib0bhv.js"></script>
		<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/blog/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/blog/css/main.css">

    </head>
    <body>
		<div class="site">
			<div class="header">
				<h1 class="title"><a href="/blog/">mike chambers</a> | <a href="">about</a></h1>
			</div>
			<h2>Tutorial : Using JSON with Flex 2 and ActionScript 3</h2>
<p class="meta">Tuesday, March 28, 2006</p>

<div class="post">
<p>One of the little gems you will find in the <a href="http://weblogs.macromedia.com/mesh/archives/2006/03/new_open_source.cfm#more">open source ActionScript 3 libraries</a> that we released on labs, is the JSON class found in the <a href="http://labs.macromedia.com/wiki/index.php/ActionScript_3:resources:apis:libraries#corelib">corelib library</a>. This class, written for Adobe by <a href="http://www.darronschall.com">Darron Schall</a>, makes it super simple to both serialize and de-serialize <a href="http://www.json.org">JSON data</a>.</p>

<p>What is JSON you ask? From the <a href="http://www.json.org">JSON website</a>:</p>

<p><em>JSON (JavaScript Object Notation) is a lightweight data-interchange format. It is easy for humans to read and write. It is easy for machines to parse and generate. It is based on a subset of the JavaScript Programming Language, Standard ECMA-262 3rd Edition &#8211; December 1999. JSON is a text format that is completely language independent but uses conventions that are familiar to programmers of the C-family of languages, including C, C++, C#, Java, JavaScript, Perl, Python, and many others. These properties make JSON an ideal data-interchange language.</em></p>

<p>In a nutshell, JSON is a way to serialize data using JavaScript syntax. It is fairly compact, and easy to use. Furthermore, it has become increasingly popular due to the growth of AJAX applications, and the browser&#8217;s native support of de-serializing JSON (via eval()).<br>
&lt;!--more--&gt;</p>

<p>If you look on the main page of my weblog, the Reading / Doing section on the left is actually a small AJAX widget I created that shows my latests <a href="http://www.digg.com">diggs</a>, <a href="http://del.icio.us/mikechambers">delicious bookmarks</a>, and items added to my <a href="http://mesh.tadalist.com/lists/show/203096">ta-da lists</a>. It gets its data from a <a href="http://weblogs.macromedia.com/mesh/mashedpotato.json">JSON feed on the server</a>, which is periodically generated by a PHP file.</p>

<p>So, to show how to use JSON within a Flex / Flash application, we will load the JSON feed from my site into Flash and display it in a datagrid. Nothing earth shattering, but it will show how easy it is to use JSON. I am not assuming that you know anything about Flex / ActionScript or JSON. Because of this, the tutorial will be pretty long, as I want to make sure I cover every step of the process.</p>

<div align="center">
  <a href="http://weblogs.macromedia.com/mesh/files/flex/jsonexample/"><img src="/mesh/files/flex/jsonexample/jsonexample.png" border="0" height="201" width="350" /></a>
</div>

<p>You can view the completed example <a href="http://weblogs.macromedia.com/mesh/files/flex/jsonexample/">here</a>. (Requires <a href="http://www.macromedia.com/go/labs_flex2_downloads">Flash Player 8.5 beta 2</a>).</p>

<p>First, you need to make sure you have the following installed:</p>

<ul>
<li>  <a href="http://www.macromedia.com/go/labs_flex2_downloads">Flex Builder or MXMLC command line compiler</a></li>
<li>  <a href="http://www.macromedia.com/go/labs_flex2_downloads">Flash Player 8.5</a></li>
<li>  <a href="http://labs.macromedia.com/wiki/index.php/ActionScript_3:resources:apis:libraries#corelib">corelib ActionScript 3 library</a></li>
</ul>

<p>You can grab Flex Builder and MXMLC from <a href="http://www.macromedia.com/go/labs_flex2_downloads">labs</a> (the MXMLC compiler is included with the Flex Builder install, and also in the SDK download (in case you are on MAC or Linux).</p>

<p>Once you download the zip file for the corelib library, unzip it and you should see three subfolders: src, bins, docs. </p>

<ul>
<li>  src : contains the source code for the library</li>
<li>  bin : contains a compiled SWC of the library (you can think of this as a DLL)</li>
<li>  docs : contains the API docs for the library</li>
</ul>

<p>You can link the project against either the source, or the SWC. For this example, we will use the SWC since we don&#8217;t need to edit the source code any.</p>

<p>Once Flex Builder is install, open it and make sure that you are in the Flex Development perspective.</p>

<p>Window &gt; Open Perspective &gt; Flex Development</p>

<p>Next, make sure the navigator view is open (it is usually on the left). This view shows all of your projects and files. If the view is not open, you can open it via:</p>

<p>Window &gt; Show View &gt; Navigator</p>

<p>Right click in the navigator and select:</p>

<p>New &gt; Flex Project</p>

<p>Name the Project &#8220;JSONExample&#8221; and make sure &#8220;Use default location&#8221; is checked.</p>

<p>Then, click the &#8220;Next&#8221; button (not finish), this takes us to a screen that will allow us to add items to our class path, or to link against libraries. (you can access this at anytime, by selecting the project, and then selecting Project &gt; Properties).</p>

<p>Select the Libraries tab, and click Add SWC. Browser to the corelib.swc file which was including in the bin directory of the corelib zip file. Click the Finish button.</p>

<p>The first thing we need to do is to add a datagrid to display the data. Our grid will contain two columns. One for the title, and one for the type of service (delicious, digg, tada).</p>

<p>Make sure that the JSONExample.mxml file is open in the editor (double click it in the Navigator), and then switch to design view (click the Design button in the top left of the editor). This brings us to design view which allows us to visually layout and manipulate our components. </p>

<p>Once you are in design view, you should see a Components view. If not, you can open it via Window &gt; Show View &gt; Components. This view contains all of the built in (and any custom components) that are available to the project. Select a DataGrid component from the Controls folder and drag it onto the stage. Once on the stage, resize it so that it takes up most of the space. The grid should snap to the edges when it gets close.</p>

<p>Make sure the grid is selected then go to the Flex Properties view. It should be open on the right, but if it isn&#8217;t you can open it via Window &gt; Show Views &gt; Flex Properties. We need to do two things here:</p>

<ol>
<li> Give the control an ID</li>
<li> Set the layout constrains</li>
</ol>

<p>Select the Id field at the top of the Flex Properties panel, and enter &#8220;grid&#8221;. This basically gives the grid a variable name so that other controls and ActionScript can reference it.</p>

<p>Next, scroll all the way to the bottom of the Flex Properties view to the Layout section. This will show your component with anchor points. Make sure that the following check boxes are checked:</p>

<ul>
<li>  Top Right</li>
<li>  Top Left</li>
<li>  Left Top</li>
<li>  Left Bottom</li>
</ul>

<p>This basically tells the controls to keeps its sides the same distance from the application&#8217;s sides, even if the app / windows resizes.</p>

<p>At this point, we are ready to switch back to source view, and load the JSON data. So, switch back to source view (click the Source button in the top left of the editor).</p>

<p>You code should now look something like this:</p>

<p><code class="inline-code">
<pre>
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" xmlns="*" layout="absolute">
    <mx:DataGrid id="grid" right="10" left="10" top="10" bottom="10">
        <mx:columns>
            <mx:DataGridColumn headerText="Column 1" dataField="col1"/>
            <mx:DataGridColumn headerText="Column 2" dataField="col2"/>
            <mx:DataGridColumn headerText="Column 3" dataField="col3"/>
        </mx:columns>
    </mx:DataGrid>
</mx:Application>
</pre>
<p></code></p>

<p>Lets add an HTTPService tag to actually load the data. Add the following tag right under the Application tag.</p>

<p><code class="inline-code">
<pre>
    <mx:HTTPService id="service" resultFormat="text" 
                    url="http://weblogs.macromedia.com/mesh/mashedpotato.json"
                    result="onJSONLoad(event)" />
</pre>
<p></code></p>

<p>If you save this, you should get an error in the problems view (Window &gt; Show Views &gt; Problems):</p>

<p><code class="inline-code">Call to a possibly undefined method 'onJSONLoad'</code></p>

<p>This is ok. We just need to define the onJSONLoad event handler. But first, lets look at the code we just wrote:</p>

<ul>
<li>  id &#8211; Give the control a variable name so we can reference it later.</li>
<li>  url &#8211; the url that points to the JSON data we are loading</li>
<li>  resultFormat &#8211; the format that we want the data returned to us in. (In this case, just the raw text).</li>
<li>  result &#8211; event handler that is called when the data loads.</li>
</ul>

<p>At this point, your code should look something like this:</p>

<p>`
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" xmlns="*" layout="absolute"></p>
<div class="highlight"><pre><code class="text"><a name="line-1"></a>&lt;mx:HTTPService id=&quot;service&quot; resultFormat=&quot;text&quot; 
<a name="line-2"></a>                url=&quot;http://weblogs.macromedia.com/mesh/mashedpotato.json&quot;
<a name="line-3"></a>                result=&quot;onJSONLoad(event)&quot; /&gt;
<a name="line-4"></a>
<a name="line-5"></a>&lt;mx:DataGrid id=&quot;grid&quot; right=&quot;10&quot; left=&quot;10&quot; top=&quot;10&quot; bottom=&quot;10&quot;&gt;
<a name="line-6"></a>    &lt;mx:columns&gt;
<a name="line-7"></a>        &lt;mx:DataGridColumn headerText=&quot;Column 1&quot; dataField=&quot;col1&quot;/&gt;
<a name="line-8"></a>        &lt;mx:DataGridColumn headerText=&quot;Column 2&quot; dataField=&quot;col2&quot;/&gt;
<a name="line-9"></a>        &lt;mx:DataGridColumn headerText=&quot;Column 3&quot; dataField=&quot;col3&quot;/&gt;
<a name="line-10"></a>    &lt;/mx:columns&gt;
<a name="line-11"></a>&lt;/mx:DataGrid&gt;
</code></pre></div>
<p><a href="/mx:Application">/mx:Application</a>
</pre>
<p>`</p>

<p>Next, we need to create a script block to define our event handler function. Add a Script tag block just below the Application tag:</p>

<p>`
<pre>
    <a href="mx:Script">mx:Script</a>
        &lt;![CDATA[</p>
<div class="highlight"><pre><code class="text"><a name="line-1"></a>    ]]&gt;
<a name="line-2"></a>&lt;/mx:Script&gt;
</code></pre></div>
<p></pre>
<p>`</p>

<p>and then inside the Script block, lets define our event handler. You script block should now look like this:</p>

<p>`
<pre>
    <a href="mx:Script">mx:Script</a>
        &lt;![CDATA[
            import mx.rpc.events.ResultEvent;</p>
<div class="highlight"><pre><code class="text"><a name="line-1"></a>        private function onJSONLoad(event:ResultEvent):void
<a name="line-2"></a>        {
<a name="line-3"></a>        }
<a name="line-4"></a>    ]]&gt;
<a name="line-5"></a>&lt;/mx:Script&gt;
</code></pre></div>
<p></pre>
<p>`</p>

<p>If you look at the <a href="http://livedocs.macromedia.com/labs/1/flex/langref/index.html">API docs</a>, ResultEvent is the type of event broadcast when the data has loaded from the service.</p>

<p>Next, all we need to do is:</p>

<ul>
<li>  Get the raw JSON data from the URL</li>
<li>  De-serialize it from JSON to ActionScript</li>
<li>  Set the data as the dataProvider for the grid</li>
</ul>

<p>Here is the completed function, with comments:</p>

<p>`
<pre>
    <a href="mx:Script">mx:Script</a>
        &lt;![CDATA[
            import mx.collections.ArrayCollection;
            import mx.rpc.events.ResultEvent;
            import com.adobe.serialization.json.JSON;</p>
<div class="highlight"><pre><code class="text"><a name="line-1"></a>        private function onJSONLoad(event:ResultEvent):void
<a name="line-2"></a>        {
<a name="line-3"></a>            //get the raw JSON data and cast to String
<a name="line-4"></a>            var rawData:String = String(event.result);
<a name="line-5"></a>
<a name="line-6"></a>            //decode the data to ActionScript using the JSON API
<a name="line-7"></a>            //in this case, the JSON data is a serialize Array of Objects.
<a name="line-8"></a>            var arr:Array = (JSON.decode(rawData) as Array);
<a name="line-9"></a>
<a name="line-10"></a>            //create a new ArrayCollection passing the de-serialized Array
<a name="line-11"></a>            //ArrayCollections work better as DataProviders, as they can
<a name="line-12"></a>            //be watched for changes.
<a name="line-13"></a>            var dp:ArrayCollection = new ArrayCollection(arr);
<a name="line-14"></a>
<a name="line-15"></a>            //pass the ArrayCollection to the DataGrid as its dataProvider.
<a name="line-16"></a>            grid.dataProvider = dp;
<a name="line-17"></a>
<a name="line-18"></a>        }
<a name="line-19"></a>    ]]&gt;
<a name="line-20"></a>&lt;/mx:Script&gt;
</code></pre></div>
<p></pre>
<p>`</p>

<p>Notice that we also added some import statements to bring in the relevant classes.</p>

<p>The actual JSON de-serialization part is pretty trivial and consists of this one line of code:</p>

<p><code class="inline-code">
<pre>var arr:Array = (JSON.decode(rawData) as Array);</pre>
<p></code></p>

<p>JSON.decode returns a Object (since it doesn&#8217;t know before hand what it will be de-serializing), so we have to cast the result to an Array using the &#8220;as&#8221; operator. (can&#8217;t cast using Array() for legacy reasons).</p>

<p>At this point, we only have two things left to do:</p>

<ol>
<li> Actually tell the service to load the data.</li>
<li> Customize the DataGrid to map to the data we are passing it.</li>
</ol>

<p>Telling the service to load the data is easy. Since we want it to load the data as soon as the app loads, we can just specify in in the creationComplete event for the app (this is called once the app has been loaded and the controls laid out). (You can think of this as the same as onload in HTML / JavaScript).</p>

<p>We just need to add this attribute to the Application tag:</p>

<p><code class="inline-code">
<pre>creationComplete="service.send()"</pre>
<p></code></p>

<p>Remember that service is the id / variable name for our HTTPService control. Basically, this says when the app has loaded and initialized, tell the HTTPService control to load its data.</p>

<p>Finally, we need to tweak the DataGrid to show our data. In this case, we only need to tweak the columns within the DataGrid.</p>

<p>First, remove one of the three column tags, since we only need two. </p>

<p>Next, we need to add better column heading titles (through the headingText attribute), and map each column to a property in the data we loaded. If you look at the JSON data, you can see the following fields in each item:</p>

<ul>
<li>  title</li>
<li>  src</li>
<li>  url</li>
<li>  date</li>
</ul>

<p>For this example, we will just show the source and title. We specify this for each column through the dataField property. So, the new columns should look like this:</p>

<p><code class="inline-code">
<pre>
            <mx:DataGridColumn headerText="Service" dataField="src"/>
            <mx:DataGridColumn headerText="Title" dataField="title"/>
</pre>
<p></code></p>

<p>Basically, this tells the first column to use Service as the column title, and get its data from the &#8220;src&#8221; property of the loaded data. The second column gets it data from the title property.</p>

<p>The completed code should now look like this:</p>

<p>`
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" xmlns="*" layout="absolute"
    creationComplete="service.send()"></p>
<div class="highlight"><pre><code class="text"><a name="line-1"></a>&lt;mx:Script&gt;
<a name="line-2"></a>    &lt;![CDATA[
<a name="line-3"></a>        import mx.collections.ArrayCollection;
<a name="line-4"></a>        import mx.rpc.events.ResultEvent;
<a name="line-5"></a>        import com.adobe.serialization.json.JSON;
<a name="line-6"></a>
<a name="line-7"></a>        private function onJSONLoad(event:ResultEvent):void
<a name="line-8"></a>        {
<a name="line-9"></a>            //get the raw JSON data and cast to String
<a name="line-10"></a>            var rawData:String = String(event.result);
<a name="line-11"></a>
<a name="line-12"></a>            //decode the data to ActionScript using the JSON API
<a name="line-13"></a>            //in this case, the JSON data is a serialize Array of Objects.
<a name="line-14"></a>            var arr:Array = (JSON.decode(rawData) as Array);
<a name="line-15"></a>
<a name="line-16"></a>            //create a new ArrayCollection passing the de-serialized Array
<a name="line-17"></a>            //ArrayCollections work better as DataProviders, as they can
<a name="line-18"></a>            //be watched for changes.
<a name="line-19"></a>            var dp:ArrayCollection = new ArrayCollection(arr);
<a name="line-20"></a>
<a name="line-21"></a>            //pass the ArrayCollection to the DataGrid as its dataProvider.
<a name="line-22"></a>            grid.dataProvider = dp;
<a name="line-23"></a>
<a name="line-24"></a>        }
<a name="line-25"></a>    ]]&gt;
<a name="line-26"></a>&lt;/mx:Script&gt;
<a name="line-27"></a>
<a name="line-28"></a>&lt;mx:HTTPService id=&quot;service&quot; resultFormat=&quot;text&quot; 
<a name="line-29"></a>                url=&quot;http://weblogs.macromedia.com/mesh/mashedpotato.json&quot;
<a name="line-30"></a>                result=&quot;onJSONLoad(event)&quot; /&gt;
<a name="line-31"></a>
<a name="line-32"></a>&lt;mx:DataGrid id=&quot;grid&quot; right=&quot;10&quot; left=&quot;10&quot; top=&quot;10&quot; bottom=&quot;10&quot;&gt;
<a name="line-33"></a>    &lt;mx:columns&gt;
<a name="line-34"></a>        &lt;mx:DataGridColumn headerText=&quot;Service&quot; dataField=&quot;src&quot;/&gt;
<a name="line-35"></a>        &lt;mx:DataGridColumn headerText=&quot;Title&quot; dataField=&quot;title&quot;/&gt;
<a name="line-36"></a>    &lt;/mx:columns&gt;
<a name="line-37"></a>&lt;/mx:DataGrid&gt;
</code></pre></div>
<p><a href="/mx:Application">/mx:Application</a>
</pre>
<p>`</p>

<p>If you debug / run your app, you should see a datagrid that contains all of the data from the JSON feed. (You can debug by clicking the little Bug icon on the toolbar, or selecting Run &gt; Debug).</p>

<p>If you are feeling generous, you can also easily publish your source code. Go back to Flex Builder, and select the JSONExample. Then select Project &gt; Publish Application Source. Once you do this, re-run your application, and then right click on it and select View Source.</p>

<p>This is a pretty simple example, but it shows how easy de-serializing JSON in ActionScript is (serialization is just as easy).</p>

<div align="center">
  <a href="http://weblogs.macromedia.com/mesh/files/flex/jsonexample/screencast/"><img src="/mesh/files/flex/jsonexample/screencast.png" border="0" height="236" width="300" /></a>
</div>

<p>Updated : You can also view a <a href="http://weblogs.macromedia.com/mesh/files/flex/jsonexample/screencast/">screencast of this tutorial</a>.</p>

<p>Here are the links for the resources used in the tutorial:</p>

<ul>
<li>  <a href="http://www.macromedia.com/go/labs_flex2_downloads">Flex Builder or MXMLC command line compiler</a></li>
<li>  <a href="http://www.macromedia.com/go/labs_flex2_downloads">Flash Player 8.5</a></li>
<li>  <a href="http://labs.macromedia.com/wiki/index.php/ActionScript_3:resources:apis:libraries#corelib">corelib ActionScript 3 library</a></li>
</ul>

<p>I will update the post with images a little later, and am considering doing a screencast of building the example.</p>

<p><strong><a href="http://digg.com/programming/Tutorial_:_Using_JSON_with_Flex_2_and_ActionScript_3">If you liked the tutorial, make sure to digg it.</a></strong></p>

<p>Post any questions, suggestions and / or corrections in the comments.</p>

</div>

			<div class="footer">
				<p>Copyright 2013 - <a href="mailto:mikechambers@gmail.com" class="email">Mike Chambers</a></p>
			</div>		
			<div id="social">
				<a href="http://www.twitter.com/mesh/"><img src="/blog/images/social/twitter.png" width="50" height="50" alt="twitter" /></a>
				<a href="https://github.com/mikechambers/"><img src="/blog/images/social/github.png" width="50" height="50" alt="github" /></a>
				<a href="http://www.flickr.com/photos/mikechambers/"><img src="/blog/images/social/flickr.png" width="50" height="50" alt="flickr" /></a>
				<a href="http://www.behance.net/mikechambers"><img src="/blog/images/social/behance.png" width="50" height="50" alt="behance" /></a>
				<a href="http://www.twitter.com/mesh/"><img src="/blog/images/social/rss.png" width="50" height="50" alt="rss" /></a>
			</div>
		</div>
    </body>
</html>
