
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Flash / Arduino Tips, Tricks and Gotchas - Mike Chambers</title>
  <meta name="author" content="Mike Chambers">

  
  <meta name="description" content="This is a ongoing post where I will post tips, tricks and gotchas that I learn while developing with Flash and the Arduino. I will update this from &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mikechambers.github.io/2010/08/06/flash-arduino-tips-tricks-and-gotchas">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Mike Chambers" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>-->
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-553659-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>



<body >

<!--
<body   >
-->
  <header role="banner"><hgroup>
  <h1><a href="/">Mike Chambers</a></h1>
  
    <h2>code is beautiful</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mikechambers.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Flash / Arduino Tips, Tricks and Gotchas</h1>
    

    
      <p class="meta">
        <!--








  


<time datetime="2010-08-06T00:00:00-07:00" pubdate data-updated="true"></time>-->
        
      </p>
    
  </header>


<div class="entry-content"><p>This is a ongoing post where I will post tips, tricks and gotchas that I learn while developing with Flash and the Arduino. I will update this from time to time with more information.<!--more--></p>

<p>&nbsp;</p>

<h3>Make sure you are using the correct BAUD Rate</h3>

<p>If your Flash / Arduino communication does not seem to be working, then make sure that you have set the BAUD rate to the same rate in both your Arduino code, and the configuration file for your Serial Proxy (such as TinkerProxy).</p>

<p>&nbsp;</p>

<h3>Slow down the BAUD Rate</h3>

<p>If you are getting weird errors, or some messages between Flash and Arduino seem to get dropped, then try slowing down your BAUD rate to 9600 and see if that fixes the issue.</p>

<p>If it does, you can then try and debug and figure out if any particular thing in your code was causing the problem.</p>

<p>&nbsp;</p>

<h3>Sending NULL Bytes from Arduino</h3>

<p>If you are using XMLSocket for your communication between Flash and Arduino, then you need to send a NULL Byte from Arduino when you are done writing a message to the serial port.</p>

<pre><code>Serial.println("Hello From Arduino");
Serial.print(0, BYTE);
</code></pre>

<p>&nbsp;</p>

<p>However, I have run into issues where if you send multiple NULL Bytes too fast, then some of the messages will get dropped (not sure if this is an Arduino, TinkerProxy or Flash issue).</p>

<p>So, if you are using XMLSocket, and seem to be losing messages from Arduino, then try reducing some of NULL Bytes being sent and see if that fixes the issues.</p>

<p>&nbsp;</p>

<h3>Sending data in Socket connect handler</h3>

<p>Be careful when sending data from Flash in the Socket class&#8217;s Event.CONNECT handler. For example:</p>

<pre><code>private function onConnect(event:Event):void
{
    _socket.writeUTFBytes("Hello from Flash");
    _socket.flush();
}
</code></pre>

<p>&nbsp;</p>

<p>My experience is that this message will be lost. Remember that the Arduino does not run its code until something connects to it. TinkerProxy appears to not connect to the Arduino until the Flash content connects to TinkerProxy.</p>

<p>Thus, the Event.CONNECT event handler may be broadcast before TinkerProxy has connected to the Arduino or before the Arduino has finished running its setup function.</p>

<p>I have found that you have to wait about 2 seconds (2000 ms) before you can reliably send data to the Arduino after you connect to TinkerProxy. So, just start a two second timer in the connect event handler, and send your data once that fires (then clean up the timer).</p>

<p>Here is an example:</p>

<pre><code>var connectTimer:Timer;
private function onConnectTimer(event:TimerEvent):void
{
    connectTimer.stop();
    connectTimer.removeEventListener(TimerEvent.TIMER, onConnectTimer);
    connectTimer = null;

    _socket.writeUTFBytes("Hello from Flash");
}

private function onConnect( event:Event ):void
{
    connectTimer = new Timer(PING_INTERVAL);
    connectTimer.addEventListener(TimerEvent.TIMER, onConnectTimer);

    connectTimer.start();
}
</code></pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<h3>Socket verses XMLSocket</h3>

<p>You can use both the String based XMLSocket class, and the binary based Socket class to send and receive data between the Flash and Arduino.</p>

<p>I suggest that you use the Socket class instead of the XMLSocket class for a number of reasons:</p>

<ol>
<li>Socket is more flexible and extensible, allowing you send send multiple data types (not just strings).</li>
<li>It can be difficult working with strings in Arduino code, and thus easier to send numbers from Flash (which requires Socket class). Ive written a seperate post with info on <a href="/blog/2010/08/01/sending-multibyte-numbers-from-actionscript-to-arduino/">how to send numbers from Flash to Arduino</a>.</li>
<li>Using XMLSocket requires that you send NULL bytes from Arduino to terminate messages, which has caused problems for me in the past (see above).</li>
</ol>


<p>Even if you just want to send Strings, I still suggest using Socket, as you then have the option in the future to send additional data types.</p>

<p>Here is how to send a String with the Socket class:</p>

<p><code>_socket.writeUTFBytes("Hi, im a String!");</code></p>

<p>The one disadvantage to using Socket verses XMLSocket, is that you have to buffer the input yourself, since all of the data may not arrive at once. However, that is pretty simple:</p>

<pre><code>//Character that delineates the end of a message received
//from the Arduino
private static const EOL_DELIMITER:String = "\n";

//string to hold data as it comes in.
private var buffer:String = "";

//event called when data arrives on the socket from the
//arduino
private function onSocketData(event:ProgressEvent):void
{
    //get the string sent from the Arduino. This could be any binary data
    //but in our case, we are sending strings.
    //In general, it is much easier to just always send strings from
    //Arduino, and then parse then in ActionScript
    var data:String = _socket.readUTFBytes( _socket.bytesAvailable );

    //copy the newly arrived data into the buffer string.
    buffer += data;

    //completed message from the server
    var msg:String;
    var index:int;

    //loop through the buffer until it contains no more
    //end of message delimiter
    while((index = buffer.indexOf(EOL_DELIMITER)) &gt; -1)
    {
        //extract the message from the beginning to where the delimiter is
        //we don't include the delimiter
        msg = buffer.substring(0, index);

        //remove the message from the buffer
        buffer = buffer.substring(index + 1);

        //trace out the message (or do whatever you want with it)
        trace("Message Received from Arduino : " + msg);
    }               

}
</code></pre>

<p>&nbsp;</p>

<p>&nbsp;</p>

<h3>Client / Server Development</h3>

<p>It can be useful to think of Flash / Arduino development as regular client / server development. Most of the communication techniques you would use when developing on the web also apply when developing with the Arduino.</p>

<p>&nbsp;</p>

<h3>Integer Division</h3>

<p>Be careful when dividing numbers on the Arduino. If you divide 2 ints, they are not automatically converted to floats, which means you may get some odd results:</p>

<p><code>5 / 15 //will result in 0</code></p>

<p>If you do need to divide ints, then cast them to a float first, like so:</p>

<p><code>(float)5/(float)15 //results in .33333</code></p>

<p>In general, you should try and work with ints, as working with floats on the Arduino is relatively slow.</p>

<p>&nbsp;</p>

<h3>Dont Upload Arduino code while Flash content is connected</h3>

<p>You can upload new Arduino / sketch programs while TinkerProxy is connected to the Arduino. However, if you try and upload a new program while your Flash content is connected to the TinkerProy (and thus the Arduino), the upload will fail.</p>

<p>Try closing the Flash content and uploading again, and if that doesn&#8217;t work, stop TinkerProxy, press the reset button on the Arduino, and try and upload it again.</p>

<p>&nbsp;</p>

<h3>Serial Monitor is your friend</h3>

<p>Before hooking up your Flash content to the Arduino, try and confirm as much of the Arduino code is working well as possible.</p>

<p>This can often be done by monitoring output (regular and debug) from the Arduino App&#8217;s Serial Monitor (<em>Arduino App > Tools > Serial Monitor</em>). (Make sure to set the correct BAUD rate in the Serial Monitor.</p>

<p>You can put in extra <code>Serial.println()</code> statements in your code, and they will be traced out to the monitor. Once you are sure things are working, then you can remove the statements.</p>

<p>&nbsp;</p>

<h3>Dont forget to blink</h3>

<p>If you are having trouble getting your Flash content to work with the Arduino (and are not receiving data from the Arduino), try blinking LEDs in different parts of your code. That can help tell you what is being run, and narrow down the issue.</p>

<p>Here is a simple function to blink the onboard LED:</p>

<pre><code>//function to blink the LED
void blinkLED(int count)
{
    //loop through
    for(int i = 0; i &lt; count; i++)
    {
        //turn LED on
        digitalWrite(LED_PIN, HIGH);

        //wait 500 ms
        delay(500);

        //turn LED off
        digitalWrite(LED_PIN, LOW);

        //wait 500 ms
        delay(500);
    }
}
</code></pre>

<p>&nbsp;</p>

<p>Which you can call in your code like so:</p>

<p><code>blink(2);</code></p>

<p>If you have any additional tips or things to watch out for, post them in the comments.</p>
</div>


  <footer>
    <p class="meta">
      <!--
  

<span class="byline author vcard">Posted by <span class="fn">mikechambers</span></span>

      








  


<time datetime="2010-08-06T00:00:00-07:00" pubdate data-updated="true"></time>
-->

  

<span class="byline author vcard">Posted by <span class="fn">mikechambers</span></span>
 on 








  


<time datetime="2010-08-06T00:00:00-07:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/general/'>General</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://mikechambers.github.io/2010/08/06/flash-arduino-tips-tricks-and-gotchas/" data-via="" data-counturl="http://mikechambers.github.io/2010/08/06/flash-arduino-tips-tricks-and-gotchas/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2010/08/04/quick-contest-flash-and-arduino/" title="Previous Post: Quick Contest : Flash and Arduino">&laquo; Quick Contest : Flash and Arduino</a>
      
      
        <a class="basic-alignment right" href="/2010/08/11/accelerate-flash-arduino-based-speedometer/" title="Next Post: Accelerate : Flash / Arduino Based Speed Detector">Accelerate : Flash / Arduino Based Speed Detector &raquo;</a>
      
    </p>
  </footer>
</article>

</div>
<!--

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/14/test-post/">Test Post</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/08/simple-http-server-for-local-testing/">Simple HTTP Server for Local Testing</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/02/north-american-flash-community-tour/">North American Flash Community Tour</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/22/flash-roadmap-whitepaper-published/">Flash Roadmap Whitepaper Published</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/13/in-europe-to-discuss-flash-roadmap/">In Europe to Discuss Flash Roadmap</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/mikechambers">@mikechambers</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mikechambers',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

-->

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Mike Chambers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mikechambers';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
