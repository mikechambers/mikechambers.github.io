
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sending Multibyte Numbers From ActionScript to Arduino - Mike Chambers</title>
  <meta name="author" content="Mike Chambers">

  
  <meta name="description" content="If you follow me on twitter, then you have probably noticed that I have been learning about Flash, physical computing and electronics lately. I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mikechambers.github.io/2010/08/01/sending-multibyte-numbers-from-actionscript-to-arduino">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Mike Chambers" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>-->
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-553659-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>



<body >

<!--
<body   >
-->
  <header role="banner"><hgroup>
  <h1><a href="/">Mike Chambers</a></h1>
  
    <h2>code is beautiful</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mikechambers.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Sending Multibyte Numbers From ActionScript to Arduino</h1>
    

    
      <p class="meta">
        <!--








  


<time datetime="2010-08-01T00:00:00-07:00" pubdate data-updated="true"></time>-->
        
      </p>
    
  </header>


<div class="entry-content"><p>If you follow me on twitter, then you have probably noticed that I have been learning about Flash, physical computing and electronics lately. I started out working with <a href="http://www.mikechambers.com/blog/2010/07/26/getting-started-with-phidgets-and-actionscript/">Phidgets</a>, and have recently begun working with the <a href="http://Arduino.cc/">Arduino</a> (Ill write up Flash / Arduino getting started tutorial shortly). I am currently working on a project where I need to send data from Flash to the Arduino, and quickly discovered that it is not as easy as I thought it would be. In this post, I will show an example of how to send multibyte Numbers from ActionScript to Arduino.</p>

<!--more-->


<p>When you send data to Arduino over the Serial port, Arduino reads that data byte by byte. Thus, if you want to send a string to the Arduino, you have to read the string byte by byte and reconstruct it which is a bit of a hassle, but nothing too difficult. However, what if you want to send a number? If you just need to send a small whole number (up to 127), then you can simply write the number to the socket:</p>

<pre><code>socket.writeByte(127);
</code></pre>

<p>&nbsp;</p>

<p>and then read the same number in Arduino by reading the byte:</p>

<pre><code>value = Serial.read();
Serial.println(value, DEC); //will send 127
</code></pre>

<p>&nbsp;</p>

<p>However, if you need to send a number larger than 127, then things get a bit tricky. This is because numbers larger than 127 require multiple bytes to send, which means that you cannot simply read in the number on the Arduino side (since you have to read byte by byte). One solution (suggested to my by <a href="http://bytearray.org/">Thibault Imbert</a>) is to multiply the number by some ratio. This would allow you to represent numbers larger than 127, but at the price of accuracy.</p>

<p>So, after much searching, I found a <a href="">post</a> on the Arduino forums that shows how to build a float from a byte array using a union. With that code as a guide, I was able to figure out how to send a float from ActionScript to Arduino.</p>

<p>I have uploaded a <a href="http://github.com/mikechambers/ExamplesByMesh/tree/master/Arduino/MultibyteNumbersFromFlash">simple example</a> into my github example code repository. The Flash part of the example is done in Flex and ActionScript, but the ActionScript code is the same regardless of what you are using to build your Flash content.</p>

<p>Note, all of the code in the examples is released under an <a href="http://www.opensource.org/licenses/mit-license.php">MIT license</a>.</p>

<p>First, lets look at the Arduino sketch:</p>

<pre><code>//union that we will use
//the construct the float
//from the individual bytes
//sent from Flash / ActionScript
union u_tag {
    byte b[4];
    float ival;
} u;

float value;

void setup()
{
  Serial.begin(9600);
}

void loop()
{  

  //this example assumes only floats / Numbers
  //are being sent. So we just look for data in 4 byte
  //increments
  if(Serial.available() &gt; 3)
  {

    //read the 4 bytes into the union
    u.b[0] = Serial.read();
    u.b[1] = Serial.read();
    u.b[2] = Serial.read();
    u.b[3] = Serial.read();

    //retrieve the float value of the union
    //(based on the bytes passed in)
    value = u.ival;

    //send the reconstructed float back to the Serial
    //flash
    Serial.print(value, DEC);

    //write out a null byte, (the Flash Socket
    //class looks for this)
    Serial.print(0, BYTE);
  }

}
</code></pre>

<p>&nbsp;</p>

<p>Now, lets look at how we send the Number from ActionScript:</p>

<pre><code>private function onApplicationComplete():void
{
    //only allow numbers, period and minus sign
    numberInput.restrict = ".0-9\\-";

    socket = new Socket()
    socket.addEventListener(Event.CONNECT, onConnect);
    socket.addEventListener(Event.CLOSE, onClose);
    socket.addEventListener( IOErrorEvent.IO_ERROR, onIOError );
    socket.addEventListener( SecurityErrorEvent.SECURITY_ERROR, onSecurityError );
    socket.addEventListener( ProgressEvent.SOCKET_DATA, onSocketData );

    //disable until we connect
    this.enabled = false;

    //this is important! If you dont set this to
    //little endian, then Arduino wont understand
    //the bytes
    socket.endian = Endian.LITTLE_ENDIAN;

    socket.connect(SERVER_ADDRESS, PORT);
}

private function onSendClick():void
{
    //get the number that the user input
    var out:Number = Number(numberInput.text);

    //write it as a float to the server.
    //this is important.
    socket.writeFloat(out);

    //if number is too big, then it will overflow on
    //the Arduino, and probably come back as 0.00000
}
</code></pre>

<p>&nbsp;</p>

<p>Again, you can <a href="http://github.com/mikechambers/ExamplesByMesh/tree/master/Arduino/MultibyteNumbersFromFlash">download the complete example from my GitHub repository</a>.</p>

<p>A couple of things to take note of. Notice that we set the Endianness of the socket to LITTLE_ENDIAN. This is necessary for Arduino to be able to understand the number we are sending.</p>

<p>Second, notice that we send the number by calling <code>socket.writeFloat</code>. I initially tried <code>writeInt</code>, but ActionScript ints are 4 bytes, where the Arduino int is 2. Thibault suggested I send the number using <code>writeShort</code>, but that also did not work.</p>

<p>Basically, the only way I was able to get it to work, was to use <code>writeFloat</code>. In practice this should not matter, but it is something you should keep in mind.</p>

<p>Now, I am pretty sure it is possible to send other ActionScript multibyte number types using <code>writeInt</code>, <code>writeUnsignedInt</code> and <code>writeShort</code>, since we are just sending raw bytes over the socket. However, I have not figured out how to reconstruct them on the Arduino side yet. If anyone gets additional types working, then post a note in the comments.</p>

<p>UPDATE : I have <a href="http://github.com/mikechambers/ExamplesByMesh/tree/master/Arduino/MultibyteIntFromFlash/">posted another exampl</a>e that shows how to send ints / shorts from ActionScript to Arduino. You can view the code <a href="http://github.com/mikechambers/ExamplesByMesh/tree/master/Arduino/MultibyteIntFromFlash/">here</a>.</p>

<p>Being able to easily send multibyte numbers make communication significantly easier, because, now, among other things, we can easily send packets of complex data. Ill leave that for another post though.</p>

<p>If you have any suggestions or corrections, then leave them in the comments.</p>
</div>


  <footer>
    <p class="meta">
      <!--
  

<span class="byline author vcard">Posted by <span class="fn">mikechambers</span></span>

      








  


<time datetime="2010-08-01T00:00:00-07:00" pubdate data-updated="true"></time>
-->

  

<span class="byline author vcard">Posted by <span class="fn">mikechambers</span></span>
 on 








  


<time datetime="2010-08-01T00:00:00-07:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/general/'>General</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://mikechambers.github.io/2010/08/01/sending-multibyte-numbers-from-actionscript-to-arduino/" data-via="" data-counturl="http://mikechambers.github.io/2010/08/01/sending-multibyte-numbers-from-actionscript-to-arduino/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2010/07/29/as3corelib-library-moved-to-github/" title="Previous Post: as3corelib Library moved to GitHub">&laquo; as3corelib Library moved to GitHub</a>
      
      
        <a class="basic-alignment right" href="/2010/08/04/getting-started-with-flash-and-arduino/" title="Next Post: Getting Started with Flash and Arduino">Getting Started with Flash and Arduino &raquo;</a>
      
    </p>
  </footer>
</article>

</div>
<!--

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/14/test-post/">Test Post</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/08/simple-http-server-for-local-testing/">Simple HTTP Server for Local Testing</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/02/north-american-flash-community-tour/">North American Flash Community Tour</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/22/flash-roadmap-whitepaper-published/">Flash Roadmap Whitepaper Published</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/13/in-europe-to-discuss-flash-roadmap/">In Europe to Discuss Flash Roadmap</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/mikechambers">@mikechambers</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mikechambers',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

-->

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Mike Chambers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mikechambers';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
