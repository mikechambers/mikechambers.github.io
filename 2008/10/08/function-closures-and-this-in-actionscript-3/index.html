
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Functions, Activation Objects and &#8216;this&#8217; in ActionScript 3 - Mike Chambers</title>
  <meta name="author" content="Mike Chambers">

  
  <meta name="description" content="I have been reading through Colin Moock&#8217;s Essential ActionScript 3 book, taking my time on each chapter to make sure I get the most out of it. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mikechambers.github.io/2008/10/08/function-closures-and-this-in-actionscript-3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Mike Chambers" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>-->
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-553659-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>



<body >

<!--
<body   >
-->
  <header role="banner"><hgroup>
  <h1><a href="/">Mike Chambers</a></h1>
  
    <h2>code is beautiful</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mikechambers.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Functions, Activation Objects and &#8216;this&#8217; in ActionScript 3</h1>
    

    
      <p class="meta">
        <!--








  


<time datetime="2008-10-08T00:00:00-07:00" pubdate data-updated="true"></time>-->
        
      </p>
    
  </header>


<div class="entry-content"><p>I have been reading through <a href="http://www.moock.org/eas3/">Colin Moock&#8217;s Essential ActionScript 3 book</a>, taking my time on each chapter to make sure I get the most out of it. I have been using ActionScript 3 pretty consistently for a couple of years (about a year before it was public), but I have been pleasantly surprised with how much stuff I am learning from reading Moock&#8217;s book.</p>

<p>Anyways, I am currently reading Chapter 5 on Functions which among other things covers function scope and <del datetime="2008-10-09T18:47:55+00:00">closures</del> activation objects (although the book goes into more detail in Chapter 16). This is one of the things that frequently trips up new developers. When creating a function, the function has access to all of the variables within its scope, even if the function is passed to and called within another scope. However, one thing to watch out for is that when using function closures, <code>this</code> always points to the Global object, and not to the object / instance that the function is called within.</p>

<!--more-->


<p>For example:</p>

<p><strong>FunctionClosureTest.as</strong></p>

<div class="highlight">
  <pre>package {
    <span style="color: #008000; font-weight: bold">import</span> flash.display.Sprite<span style="color: #666666">;</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> FunctionClosureTest <span style="color: #008000; font-weight: bold">extends</span> Sprite
    {
        <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> FunctionClosureTest()
        {
            
            <span style="color: #008000; font-weight: bold">var</span> f<span style="color: #666666">:</span><span style="color: #008000">Function</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">function</span>()<span style="color: #666666">:</span>void
            {
                <span style="color: #0000FF">trace</span>(<span style="color: #008000; font-weight: bold">this</span>);
            }
            
            f();<span style="color: #408080; font-style: italic">//call function</span>
            <span style="color: #0000FF">trace</span>(<span style="color: #008000; font-weight: bold">this</span>);<span style="color: #408080; font-style: italic">//trace current scope</span>
            
            <span style="color: #008000; font-weight: bold">var</span> k<span style="color: #666666">:</span>Foo <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> Foo();
            k.runFunction(f);<span style="color: #408080; font-style: italic">//call function in different instance</span>
        }
        
        <span style="color: #008000; font-weight: bold">public</span> override <span style="color: #008000; font-weight: bold">function</span> toString()<span style="color: #666666">:</span><span style="color: #008000">String</span>
        {
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">"FunctionClosureTest"</span><span style="color: #666666">;</span>    
        }
    }
}


<span style="color: #008000; font-weight: bold">class</span> Foo
{
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> runFunction(f<span style="color: #666666">:</span><span style="color: #008000">Function</span>)<span style="color: #666666">:</span>void
    {
        f();
    }
}

<span style="color: #408080; font-style: italic">//rewrite toString for Global object</span>
<span style="color: #008000; font-weight: bold">this</span>.toString <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">function</span>()<span style="color: #666666">:</span><span style="color: #008000">String</span>
{
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">"Global"</span>
}
</pre>
</div>


<p>&nbsp;</p>

<p>Outputs:</p>

<pre><code>Global
FunctionClosureTest
Global&lt;/pre&gt;
&lt;p&gt;&lt;/p&gt;
However, this doesn't mean that we cant access the original scope that this points to. We just need to copy that to the local scope in a variable, so it is stored and accessible within the function closure.


Here is the updated example:


**FunctionClosureTest.as**


&lt;div class="highlight"&gt;
  &lt;pre&gt;package {
&lt;span style="color: #008000; font-weight: bold"&gt;import&lt;/span&gt; flash.display.Sprite&lt;span style="color: #666666"&gt;;&lt;/span&gt;

&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; FunctionClosureTest &lt;span style="color: #008000; font-weight: bold"&gt;extends&lt;/span&gt; Sprite
{
    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;function&lt;/span&gt; FunctionClosureTest()
    {
        &lt;span style="color: #008000; font-weight: bold"&gt;var&lt;/span&gt; scope&lt;span style="color: #666666"&gt;:&lt;/span&gt;&lt;span style="color: #008000"&gt;Object&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;&lt;span style="color: #666666"&gt;;&lt;/span&gt;
        &lt;span style="color: #008000; font-weight: bold"&gt;var&lt;/span&gt; f&lt;span style="color: #666666"&gt;:&lt;/span&gt;&lt;span style="color: #008000"&gt;Function&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;function&lt;/span&gt;()&lt;span style="color: #666666"&gt;:&lt;/span&gt;void
        {
            &lt;span style="color: #0000FF"&gt;trace&lt;/span&gt;(scope);
        }

        f();&lt;span style="color: #408080; font-style: italic"&gt;//call function&lt;/span&gt;
        &lt;span style="color: #0000FF"&gt;trace&lt;/span&gt;(&lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;);&lt;span style="color: #408080; font-style: italic"&gt;//trace current scope&lt;/span&gt;

        &lt;span style="color: #008000; font-weight: bold"&gt;var&lt;/span&gt; k&lt;span style="color: #666666"&gt;:&lt;/span&gt;Foo &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; Foo();
        k.runFunction(f);&lt;span style="color: #408080; font-style: italic"&gt;//call function in different instance&lt;/span&gt;
    }

    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; override &lt;span style="color: #008000; font-weight: bold"&gt;function&lt;/span&gt; toString()&lt;span style="color: #666666"&gt;:&lt;/span&gt;&lt;span style="color: #008000"&gt;String&lt;/span&gt;
    {
        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #BA2121"&gt;"FunctionClosureTest"&lt;/span&gt;&lt;span style="color: #666666"&gt;;&lt;/span&gt;    
    }
}
</code></pre>

<p>}</p>

<p><span style="color: #008000; font-weight: bold">class</span> Foo
{</p>

<pre><code>&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;function&lt;/span&gt; runFunction(f&lt;span style="color: #666666"&gt;:&lt;/span&gt;&lt;span style="color: #008000"&gt;Function&lt;/span&gt;)&lt;span style="color: #666666"&gt;:&lt;/span&gt;void
{
    f();
}
</code></pre>

<p>}</p>

<p><span style="color: #408080; font-style: italic">//rewrite toString for Global object</span>
<span style="color: #008000; font-weight: bold">this</span>.toString <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">function</span>()<span style="color: #666666">:</span><span style="color: #008000">String</span>
{</p>

<pre><code>&lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #BA2121"&gt;"Global"&lt;/span&gt;
</code></pre>

<p>}
</pre></p>

<pre><code>&lt;/div&gt;


&amp;nbsp;


The only change is to store a reference to the current this in a variable, and then access that variable from the &lt;del datetime="2008-10-09T18:47:55+00:00"&gt;function closure&lt;/del&gt; activation object.


&lt;div class="highlight"&gt;
  &lt;pre&gt;&lt;span style="color: #008000; font-weight: bold"&gt;var&lt;/span&gt; scope&lt;span style="color: #666666"&gt;:&lt;/span&gt;&lt;span style="color: #008000"&gt;Object&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;&lt;span style="color: #666666"&gt;;&lt;/span&gt;
</code></pre>

<p><span style="color: #008000; font-weight: bold">var</span> f<span style="color: #666666">:</span><span style="color: #008000">Function</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">function</span>()<span style="color: #666666">:</span>void
{</p>

<pre><code>&lt;span style="color: #0000FF"&gt;trace&lt;/span&gt;(scope);
</code></pre>

<p>}
</pre></p>

<pre><code>&lt;/div&gt;


&amp;nbsp;


This now outputs:


    FunctionClosureTest
    FunctionClosureTest
    FunctionClosureTest


By storing the this reference in a local variable, we are able to then access it later from the &lt;del datetime="2008-10-09T18:47:55+00:00"&gt;function closure&lt;/del&gt; activation object, regardless of which scope the function is called within.
</code></pre>
</div>


  <footer>
    <p class="meta">
      <!--
  

<span class="byline author vcard">Posted by <span class="fn">mikechambers</span></span>

      








  


<time datetime="2008-10-08T00:00:00-07:00" pubdate data-updated="true"></time>
-->

  

<span class="byline author vcard">Posted by <span class="fn">mikechambers</span></span>
 on 








  


<time datetime="2008-10-08T00:00:00-07:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/general/'>General</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://mikechambers.github.io/2008/10/08/function-closures-and-this-in-actionscript-3/" data-via="" data-counturl="http://mikechambers.github.io/2008/10/08/function-closures-and-this-in-actionscript-3/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2008/10/06/flash-camp-this-weekend-in-san-francisco/" title="Previous Post: Flash Camp this weekend in San Francisco">&laquo; Flash Camp this weekend in San Francisco</a>
      
      
        <a class="basic-alignment right" href="/2008/10/09/bash-scripts-for-working-with-actionscript-3-in-textmate/" title="Next Post: Bash Scripts for working with ActionScript 3 in TextMate">Bash Scripts for working with ActionScript 3 in TextMate &raquo;</a>
      
    </p>
  </footer>
</article>

</div>
<!--

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/14/test-post/">Test Post</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/08/simple-http-server-for-local-testing/">Simple HTTP Server for Local Testing</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/02/north-american-flash-community-tour/">North American Flash Community Tour</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/22/flash-roadmap-whitepaper-published/">Flash Roadmap Whitepaper Published</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/13/in-europe-to-discuss-flash-roadmap/">In Europe to Discuss Flash Roadmap</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/mikechambers">@mikechambers</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mikechambers',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

-->

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Mike Chambers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mikechambers';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
